<!DOCTYPE html>
<html>
<head>
  <title>Grunt: development & distribution environments</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width">

  <!--RSS-->
  <link rel="alternate" type="application/rss+xml" title="Bruno Garcia" href="http://blog.garciaechegaray.com/feed.xml">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/app.css?v=4">

  <!--Favicon-->
  <link rel="shortcut icon" href="/favicon.ico" />

  <!--Modernizr-->
  <script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.7.0/modernizr.min.js"></script>

  <!--Google Analytics-->
  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-18260985-4']);
    _gaq.push(['_setDomainName', '.garciaechegaray.com']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script>

</head>
<body>

  <!--Nav-->
  <div class="fixed">
    <nav class="top-bar" data-topbar>

      <ul class="title-area">
        <li class="name">
          <h1><a href="http://blog.garciaechegaray.com/">Bruno Garcia Echegaray</a></h1>
        </li>
        <li class="toggle-topbar menu-icon">
          <a href="">
            <span>Menu</span>
          </a>
        </li>
      </ul>

      <section class="top-bar-section">
        <ul class="right">
          <li class="divider"></li>
          <li><a href="http://bruno.garciaechegaray.com">Sobre mi</a></li>
          <li class="divider"></li>
          <li class="active"><a href="http://blog.garciaechegaray.com/">Blog</a></li>
          <li class="divider"></li>
          <li><a href="http://www.tuttifrescuni.com" title="Tutti Frescuni: ¿qué frutas y verduras se encuentran de temporada?" target="_blank">Pet Project</a></li>
          <li class="divider"></li>
          <li><a href="https://github.com/brunogarcia/Front-end-Wiki/wiki" title="Front-end Development Resources" target="_blank">Wiki</a></li>
        </ul>
      </section>

    </nav>
  </div>

  <!--Main-->
  <div class="main">
    <div class="row post-main">
	<div class="small-12 columns">
		<h1>Grunt: development & distribution environments</h1>
		<p class="meta">18 Sep 2015</p>

		<div class="post">
		<hr>

<p><big>Llevo trabajando con Grunt mucho tiempo, al principio solo lo utilizaba para compilar ficheros LESS/Sass o para concatenar y comprimir ficheros JS. Pero últimamente lo utilizo para crear entornos de trabajo diferenciados, por ejemplo un entorno para desarrollo y otro para distribución. </p>

<p>Si quieres ver un ejemplo real, he creado una <a href="https://github.com/brunogarcia/panda/blob/master/Gruntfile.js">plantilla</a> para un pet project.</big></p>

<hr>

<h2>Entorno de desarrollo</h2>

<p>Es el entorno que utilizo para trabajar en local. Dentro del proyecto, se ubica en la carpeta <code>dev</code>. Este grupo de tareas se llama <code>default</code> y la registro de la siguiente forma:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">grunt.registerTask(&#39;default&#39;, [&#39;connect:livereload&#39;, &#39;watch&#39;]);
</code></pre></div>
<h3>Connect</h3>

<p>Primero arranco un servidor Node con la ayuda del plugin <a href="https://github.com/gruntjs/grunt-contrib-connect">Connect</a> y abro automáticamente un navegador con la IP y el puerto especificado en la configuración. Por defecto <code>http://localhost:9001</code>.</p>

<script src="https://gist.github.com/brunogarcia/1c2ddab2790a4adf9a7e.js"></script>

<h3>Watch</h3>

<p>Despúes configuro <a href="https://www.npmjs.com/package/grunt-contrib-watch">Watch</a> conjuntamente con <em>livereload</em>. Esta combinación me permite <em>observar</em> modificaciones en un listado de ficheros y actualizar el navegador automáticamente cuando sea necesario. Esto mejora mucho mi flujo de trabajo, sobre todo si dispones de dos monitores. Es una maravilla ver los cambios aplicados inmediatamente en el navegador.</p>

<script src="https://gist.github.com/brunogarcia/f0a932a1d48d1ddc5353.js"></script>

<h3>Sass</h3>

<p>Utilizo el plugin <a href="https://www.npmjs.com/package/grunt-contrib-sass">Sass</a> para Grunt que me permite transformar mis ficheros <code>scss</code> a <code>css</code>. En el entorno <code>dev</code>, compilo Sass en modo <em>expanded</em> para poder debugear los ficheros <code>css</code> fácilmente. Para que este plugin funcione necesitas tener instalado Ruby y Sass.</p>

<script src="https://gist.github.com/brunogarcia/a5632a66b7e945317a52.js"></script>

<h3>JSHint</h3>

<p>Por último utilizo <a href="https://github.com/gruntjs/grunt-contrib-jshint">JSHint</a> para comprobar que mi código Javascript no contiene ningún error. </p>

<script src="https://gist.github.com/brunogarcia/404def30d6708c78bc0b.js"></script>

<p>Este plugin se configura con un fichero llamado <code>.jshintrc</code> que en nuestro caso contiene los siguientes valores:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">{
  // Require {} for every new block or scope
  &quot;curly&quot;: true, 

  // Tolerate use of `== null`
  &quot;eqnull&quot;: true, 

  // Require triple equals (===) for comparison
  &quot;eqeqeq&quot;: true,

  // Require all non-global variables to be declared (prevents global leaks)
  &quot;undef&quot;: true,

  // Custom globals: additional predefined global variables
  &quot;globals&quot;: {
    &quot;jQuery&quot;: true,
    &quot;createjs&quot;: true,
    &quot;document&quot;: true,
    &quot;require&quot;: true,
    &quot;module&quot;: true
  }
}
</code></pre></div>
<p>Si estas opciones se te quedan cortas, existen <a href="https://github.com/jshint/jshint/blob/master/examples/.jshintrc">multiples opciones de configuración</a> para JSHint.</p>

<hr>

<h2>Entorno de distribución</h2>

<p>Es el entorno que utilizo para hacer deploy en el servidor de producción. Dentro del proyecto, se ubica en las carpetas <code>dist</code> y <code>tmp</code>. Ambas carpetas se encuentran añadidas al <code>.gitignore</code>, ya que no nos interesa tenerlas en el repositorio de versiones.</p>

<p>Este grupo de tareas se llama <code>dist</code> y la registro de la siguiente forma:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">grunt.registerTask(&#39;dist&#39;, [&#39;clean&#39;, &#39;copy&#39;, &#39;uglify&#39;, &#39;processhtml&#39;, &#39;htmlmin:dist&#39;, &#39;sass:dist&#39;, &#39;cachebreaker&#39;]);
</code></pre></div>
<p>La configuración de este entorno es un poco más compleja, ya que requiere un mayor número de plugins, todos ellos debidamente coordinados. 
El orden de las tareas es importante. Tal como funciona Grunt, necesito modificar y guardar ficheros en la carpeta <code>temp</code> para que las tareas puedan hacer su trabajo.</p>

<h3>Clean</h3>

<p>Primero utilizo el plugin <a href="https://github.com/gruntjs/grunt-contrib-clean">Clean</a> para borrar todo el contenido de las carpetas <code>dist</code> y <code>tmp</code>. Esto me facilita tener en todo momento un entorno de distribución actualizado, sin archivos innecesarios.</p>

<script src="https://gist.github.com/brunogarcia/359691d6c12db5e98cfb.js"></script>

<h3>Copy</h3>

<p>El plugin <a href="https://github.com/gruntjs/grunt-contrib-copy">Copy</a> me permite copiar ficheros de una carpeta a otra. En este caso desde <code>dev/assets</code> a <code>dist/assets</code>. En esta carpeta guardo todos los ficheros que necesita la parte front del proyecto: css, js, imagenes, fuentes, etc.</p>

<script src="https://gist.github.com/brunogarcia/e46c4fb1880f0755ceda.js"></script>

<h3>Uglify</h3>

<p><a href="https://github.com/gruntjs/grunt-contrib-uglify">Uglify</a> me permite concatenar y comprimir los ficheros <code>.js</code> de la aplicación. </p>

<script src="https://gist.github.com/brunogarcia/e891f7886a0b62898720.js"></script>

<h3>Process HTML</h3>

<p><a href="https://www.npmjs.com/package/grunt-processhtml">Process html</a> es un plugin muy útil para editar o eliminar partes de un fichero <code>HTML</code>. Imaginate que tu aplicación trabaja con 5 librerías Javascript distintas. En modo desarrollo te interesa tenerlas separadas para debugear tranquilamente, pero cuando vas a hacer un deploy necesitas tenerlas todas en un solo fichero. </p>

<p>Con este plugin podrás especificar exactamente este comportamiento. Por ejemplo estas dos librerías:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;!-- build:js app.js --&gt;
&lt;script src=&quot;my/lib/path/lib.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;my/deep/development/path/script.js&quot;&gt;&lt;/script&gt;
&lt;!-- /build --&gt;
</code></pre></div>
<p>Se convertirán en esta otra:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;script src=&quot;app.js&quot;&gt;&lt;/script&gt;
</code></pre></div>
<p>Incluso puedes eliminar una etiqueta o grupo de etiquetas del fichero <code>HTML</code></p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;!-- build:remove --&gt;
&lt;span id=&quot;debug&quot;&gt;Soy un texto para el entorno de desarrollo&lt;/span&gt;
&lt;!-- /build --&gt;
</code></pre></div>
<p>Y la configuración es bastante simple:</p>

<script src="https://gist.github.com/brunogarcia/56e9033b82d56afd0618.js"></script> 

<h3>HTML Min</h3>

<p><a href="https://github.com/gruntjs/grunt-contrib-htmlmin">HTML Min</a> hace exactamente lo que su nombre indica, comprime el fichero <code>HTML</code>. Incluso puedes espefificar que elimine los comentarios que pueda tener tu fichero.</p>

<script src="https://gist.github.com/brunogarcia/50f3428f05c3868285b5.js"></script>

<h3>Sass</h3>

<p>En el entorno <code>dist</code>, compilo Sass en modo <em>compressed</em>. Todas las <a href="http://sass-lang.com/documentation/file.SASS_REFERENCE.html#output_style">configuraciones de salida</a> de Sass las puedes encontrar en la documentación oficial.</p>

<script src="https://gist.github.com/brunogarcia/3e6f1e6c797c2e882cf8.js"></script>

<h3>Cache Breaker</h3>

<p><a href="https://www.npmjs.com/package/grunt-cache-breaker">Cache Breaker</a> me permite <em>engañar</em> al browser añadiendo un <em>timestamp</em> a las urls que yo decida.</p>

<script src="https://gist.github.com/brunogarcia/88aca2a93303ea177ac3.js"></script>

<hr>

<h2>Utilidades</h2>

<p>Además la <a href="https://github.com/brunogarcia/panda/blob/master/Gruntfile.js">plantilla</a> dispone de un par de plugins extras.</p>

<h3>FTP Deploy</h3>

<p>Con <a href="https://github.com/zonak/grunt-ftp-deploy">FTP Deploy</a> puedo realizar subidas por FTP automáticamente. Esta tarea la tengo registrada como <code>ftp</code> y va unida con la tarea de distribución.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">grunt.registerTask(&#39;ftp&#39;, [&#39;dist&#39;, &#39;ftp-deploy&#39;]);
</code></pre></div>
<p>En la configuración, además de los datos obvios (host, puerto, carpeta de destino, etc.), debes especificar la key del fichero <code>.ftppass</code> que contiene tu nombre de usuario y contraseña.</p>

<script src="https://gist.github.com/brunogarcia/a68d50b58862db6337c0.js"></script>

<h3>Bowercopy</h3>

<p>Dependiendo del autor de la librería encontrarás muchas carperas y ficheros que no serán necesarios para tu proyecto. Hago uso de <a href="https://www.npmjs.com/package/grunt-bowercopy">Bowercopy</a> para copiar únicamente los ficheros que necesita mi proyecto. </p>

<script src="https://gist.github.com/brunogarcia/1d1d7da1246e5688c20d.js"></script>

		</div>
	</div>
</div>

  </div>

  <!--Footer-->
  <div class="row">
    <hr>
    <footer>
      <div class="small-12 columns">
        <p>Blog desarrollado con <a href="http://jekyllrb.com">Jekyll</a> y <a href="http://foundation.zurb.com">Foundation</a>. Alojado en <a href="https://github.com/brunogarcia/brunogarcia.github.io">GitHub Pages</a>. Suscríbete al <a href="/feed.xml">RSS</a></p>
      </div>

    </footer>
  </div>

  <script src="/js/build/production.min.js"></script>
</body>
</html>
