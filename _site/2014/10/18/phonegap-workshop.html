<!DOCTYPE html>
<html>
<head>
  <title>Introducción a Phonegap: webview, plugins y herramientas</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width">

  <!--RSS-->
  <link rel="alternate" type="application/rss+xml" title="Bruno Garcia" href="http://blog.garciaechegaray.com/feed.xml">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/app.css?v=3">

  <!--Favicon-->
  <link rel="shortcut icon" href="/favicon.ico" />

  <!--Modernizr-->
  <script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.7.0/modernizr.min.js"></script>

  <!--Google Analytics-->
  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-18260985-4']);
    _gaq.push(['_setDomainName', '.garciaechegaray.com']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script>

</head>
<body>

  <!--Nav-->
  <div class="fixed">
    <nav class="top-bar" data-topbar>

      <ul class="title-area">
        <li class="name">
          <h1><a href="http://blog.garciaechegaray.com/">Bruno Garcia Echegaray</a></h1>
        </li>
        <li class="toggle-topbar menu-icon">
          <a href="">
            <span>Menu</span>
          </a>
        </li>
      </ul>

      <section class="top-bar-section">
        <ul class="right">
          <li class="divider"></li>
          <li><a href="http://bruno.garciaechegaray.com">Sobre mi</a></li>
          <li class="divider"></li>
          <li class="active"><a href="http://blog.garciaechegaray.com/">Blog</a></li>
          <li class="divider"></li>
          <li><a href="http://www.tuttifrescuni.com" title="Tutti Frescuni: ¿qué frutas y verduras se encuentran de temporada?" target="_blank">Pet Project</a></li>
          <li class="divider"></li>
          <li><a href="https://github.com/brunogarcia/Front-end-Wiki/wiki" title="Front-end Development Resources" target="_blank">Wiki</a></li>
        </ul>
      </section>

    </nav>
  </div>

  <!--Main-->
  <div class="main">
    <div class="row post-main">
	<div class="small-12 columns">
		<h1>Introducción a Phonegap: webview, plugins y herramientas</h1>
		<p class="meta">18 Oct 2014</p>

		<div class="post">
		<hr>

<p><big>Desde hace unos meses es costumbre en <a href="http://www.pounstudio.com">Poun Studio</a> realizar talleres internos con la idea de transmitir conocimiento al resto del equipo. Este es mi segundo taller, y he hablado sobre <a href="http://www.phonegap.com">Phonegap</a>.</big></p>

<hr>

<p>Se ha hablado mucho de la calidad de rendimiento de una app mobile desarrollada con Phonegap. Hasta hace poco se podían escuchar frases del tipo &quot;no se siente como una app nativa&quot;, &quot;jamás igualará en velocidad a una app nativa&quot;, etc. Creo que en las primeras versiones esto era cierto, pero recordemos que ya estamos en la versión 3.6.3. Además los dispositivos móviles van mejorando día a día en rendimiento (sí, incluso los móviles chinos).</p>

<p>En todo caso, me gustaría comenzar este artículo con la siguiente viñeta, que la verdad dice mucho del estado actual del desarrollo móvil: no es un camino de rosas. Elegir entre una u otra tecnología puede depender de otros factores, como por ejemplo el económico. Si el presupuesto no te permite un equipo de desarrollo dual (uno para Android y otro para iOS) entonces Phonegap es la mejor opción. En un primer momento puedes prototipar un mínimo producto viable en poco tiempo y continuar el desarrollo hacia una app nativa en el futuro. Pienso que la tecnología debe servir a un propósito y no al revés.</p>

<p>Otro punto importante a recordar es que Phonegap no tiene una UI para móviles, para esto te tienes que apoyar en librerías como jQuery Mobile, Bootstrap o Foundation. Tampoco es un framework MVC, para eso ya existe Backbone, Angular o Ionic. Phonegap sólo te proporciona un <em>puente</em> entre el dispositivo móvil y tu aplicación web.</p>

<p><img src="https://pbs.twimg.com/media/BvWeD2yCAAArJXb.jpg:large" alt="The dilemna of mobile apps development"></p>

<p><small>Viñeta original en <a href="http://www.commitstrip.com/en/2014/08/18/the-dilemna-of-mobile-apps-development/">Commit Strip</a></small></p>

<hr>

<h2>Un poco de historia</h2>

<p>Cuando comencé a investigar y realizar mis primeras pruebas con <a href="http://www.phonegap.com">Phonegap</a>, no tenía muy clara la relación con <a href="http://cordova.apache.org">Apache Cordova</a>. La verdad, la historia es muy poco enrevesada, sobre todo porque en la propia documentación oficial se utilizan los dos nombres indistintamente. Esto es algo que ellos mismos han admitido y esperan ir solucionando en el futuro. </p>

<p>La empresa canadiense Nitobi Software fue la creadora original de Phonegap. En el 2009 ganó el <a href="http://readwrite.com/2009/04/02/phone_gap_todays_peoples_choice_winner_at_launch_p">People&#39;s Choice Award</a> en la conferencia <a href="http://www.web2expo.com/webexsf2009">Web 2.0 Expo</a>. Desde entonces se hizo muy popular en la comunidad web y se comenzó a utilizar rápidamente. </p>

<p>Recuerdo que <a href="https://twitter.com/ojoven">Mikel</a> me lo comentó con mucho entusiasmo (él siempre se excita con cositas como esta) allá por el 2010, pensando que sería una buena opción para la app mobile de <a href="http://gzaas.com">Gzaas</a>. Eramos el target perfecto, aunque teníamos mucha experiencia en el desarrollo web, ninguno de los dos conocía nada de Android o iOS. Phonegap era un regalo del cielo. Podriamos crear una app mobile con tecnología que ya conocíamos: HTML, CSS y Javascript. Además ¿quién carallo quiere aprender <a href="http://en.wikipedia.org/wiki/Objective-C">Objective-C</a>? (eso lo pensaba entonces y me reafirmo. Hola <a href="https://developer.apple.com/swift/">Swift</a>).</p>

<p>Y parece que no éramos los únicos que vieron el gran potencial de esta herramienta. <a href="http://www.adobe.com/aboutadobe/pressroom/pressreleases/201110/AdobeAcquiresNitobi.html">Adobe compró Nitobi</a>  en enero del 2011. Fue una buena jugada, por entonces Adobe estaba en horas bajas después de que <a href="http://en.wikipedia.org/wiki/Apple_and_Adobe_Flash_controversy">Apple <em>baneara</em> Flash</a> del iPhone/iPad. Me imagino a la plana mayor de Adobe corriendo como pollos sin cabeza, gritando <em>&quot;¡Nos vamos a quedar fuera del negocio de internet como Microsoft!. ¡Flash ha muerto!. ¡Además ya nadie usa la mierda esa de Dreamweaver!&quot;</em>.</p>

<p>Pero cuidado, el dinero no lo compra todo. En sus inicios Phonegap se creó como una herramienta de código abierto. Además de Nitobi, la comunidad web y otras empresas del sector (IBM, Oracle, etc.) habían colaborado en el desarrollo. Para no tener problemas legales Adobe cedió el código a la <a href="http://www.apache.org/">Fundación Apache</a>. Y de allí el nombre Apache Cordova.</p>

<p>Resumen: <a href="http://cordova.apache.org">Apache Cordova</a> es un proyecto de software libre que sirve de core a Phonegap. Esto convierte a Phonegap es una distribución con servicios adicionales dentro del ecosistema Adobe, algo que obviamente Cordova por defecto no tiene ni tendrá.</p>

<p>Puedes encontrar más información al respecto en <a href="http://phonegap.com/2012/03/19/phonegap-cordova-and-what%E2%80%99s-in-a-name/">PhoneGap, Cordova, and what’s in a name?</a>. Y si sientes curiosidad, puedes ver el código fuente en <a href="https://github.com/phonegap">Github</a>.</p>

<hr>

<h2>¿Cómo funciona?</h2>

<p>Phonegap permite conectar un dispositivo móvil con nuestra aplicación web mediante dos componentes principales: <strong>Webview</strong> y <strong>Plugins</strong>. Además Phonegap dispone de una serie de <a href="http://docs.phonegap.com/en/3.5.0/cordova_events_events.md.html#Events">eventos</a> para facilitar la comunicación entre ambas partes.</p>

<h3>Webview</h3>

<p>Un webview es básicamente una instancia del navegador del dispositivo móvil. </p>

<p>Con la particularidad de no tener interfaz de usuario. O sea, sin acceso a los favoritos, barra de navegación y demás características de cualquier navegador. Sólo nos quedamos con los motores de renderizado y Javascript. Al ser un componente 100% nativo, tendremos acceso directo al dispositivo, y por lo tanto a la cámara, GPS, batería, etc.</p>

<p>Si revisamos la documentación de Android, veremos que existe una clase llamada <a href="http://developer.android.com/reference/android/webkit/WebView.html">Webview</a>, cuya descripción es <em>&quot;A View that displays web pages. This class is the basis upon which you can roll your own web browser or simply display some online content within your Activity. It uses the WebKit rendering engine to display web pages and includes methods to navigate forward and backward through a history, zoom in and out, perform text searches and more.&quot;</em></p>

<p>Y lo mismo con iOS, en este caso la clase se llama <a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIWebView_Class/index.html">UIWebView</a>: <em>&quot;You use the UIWebView class to embed web content in your application. To do so, you simply create a UIWebView object, attach it to a window, and send it a request to load web content. You can also use this class to move back and forward in the history of webpages, and you can even set some web content properties programmatically.&quot;</em></p>

<h3>Plugins</h3>

<p>Un plugin de Phonegap es el puente entre nuestra aplicación web (cuyo contexto de ejecución es un WebView) y el dispositivo móvil. Se compone de dos partes: la <strong>implementación nativa</strong> (ya sea en Android, iOS, etc.) y la <strong>implementación Javascript</strong>.</p>

<p>Phonegap tiene alrededor de <a href="http://docs.phonegap.com/en/3.5.0/cordova_plugins_pluginapis.md.html#Plugin%20APIs">20 plugins oficiales</a>. Entre los que se encuentran los más básicos: bateria, cámara, lista de contactos, acceso al sistema de archivos, geolocalización, vibración.</p>

<p>Además la comunidad web ha ido desarrollando hasta el momento alrededor de 1400 plugins para prácticamente cualquier necesidad. <a href="http://plugreg.com/">PlugReg</a> tiene una buena lista de plugins organizado por plataformas. Aqui podemos encontrar plugins como <a href="http://plugreg.com/plugin/wildabeast/BarcodeScanner">barcode scanner</a>, <a href="http://plugreg.com/plugin/phonegap-build/PushPlugin">push notifications</a> o <a href="http://plugreg.com/plugin/EddyVerbruggen/SocialSharing-PhoneGap-Plugin">social sharing</a>.</p>

<p>Si le echamos un ojo al código fuente de un plugin, por ejemplo <a href="https://github.com/apache/cordova-plugin-splashscreen">Splash Screen</a>, veremos la siguiente estructura:</p>

<ul>
<li><p><strong>doc</strong>: Documentación i18n.</p></li>
<li><p><strong>src</strong>: Implementación nativa. Encontraremos tantas carpetas como soporte tenga el plugin para un sistema operativo en concreto. En el caso de Splash Screen tiene soporte para Android, Blackberry 10, iOS, Tizen, Ubuntu Touch y Window Phone. Si abrimos la clase <a href="https://github.com/apache/cordova-plugin-splashscreen/blob/master/src/android/SplashScreen.java">SplashScreen.java</a>, veremos un único método llamado <em>execute</em> que se encargará de realizar la tarea asignada, en este caso mostrar u ocultar el splash screen.</p></li>
<li><p><strong>tests</strong>: Tests unitarios para confirmar que todo funciona como debe funcionar.</p></li>
<li><p><strong>www</strong>: Implementación Javascript. Estas funciones son las que usará nuestra aplicación web para comunicarse con el dispositivo móvil. Si abrimos <a href="https://github.com/apache/cordova-plugin-splashscreen/blob/master/www/splashscreen.js">splashscreen.js</a> veremos las funciones show() y hide().</p></li>
</ul>

<p>Podéis encontrar más información al respecto en <a href="http://docs.phonegap.com/en/3.5.0/guide_hybrid_plugins_index.md.html#Plugin%20Development%20Guide">Plugin Development Guide</a>.</p>

<hr>

<h2>Instalar Phonegap y crear una demo</h2>

<p>Antes de ponernos a trabajar con Phonegap, es necesario tener instalado <a href="http://nodejs.org/download/">Node</a>. Si ya tienes instalado Node, es buena idea <a href="http://davidwalsh.name/upgrade-nodejs">actualizarlo</a>.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ sudo npm cache clean -f
$ sudo npm install -g n
$ sudo n stable
</code></pre></div>
<p>Seguidamente basta con lanzar la siguiente línea en tu terminal:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ sudo npm install -g phonegap
</code></pre></div>
<p>Node Package Manager o <em>npm</em>, tal como su nombre indica es el gestor de paquetes de Node. La opción <em>&quot;-g&quot;</em> instalará Phonegap de forma global.</p>

<p>Finalizado este segundo paso, ya podremos crear nuestra primera app mobile con Phonegap.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ phonegap create [folder-name] [namespace] [project-name]
</code></pre></div>
<p>Si accedemos a [folder-name] veremos una carpeta llamada &quot;<em>www</em>&quot;. Es allí donde residirá nuestra aplicación web. Recuerda realizar las llamadas correspondientes a <em>cordova.js</em> e <em>index.js</em>. En esta última se encuentran los <em>bind event listeners</em>. Por defecto viene &quot;<em>bindiado</em>&quot; <a href="http://docs.phonegap.com/en/3.5.0/cordova_events_events.md.html#deviceready">deviceready</a>.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">document.addEventListener(&#39;deviceready&#39;, this.onDeviceReady, false);
</code></pre></div>
<p>El objetivo de este evento es informarnos de la correcta carga de la API de Cordova en el dispositivo móvil. Esto es así porque necesitamos que Cordova este debidamente cargado para que nuestra aplicación web pueda realizar las llamadas necesarias. </p>

<p>Si has llegado hasta aquí, supongo que te estarás preguntando &quot;bueno, ¿y cómo hago para visualizar esta demo en mi movil?&quot;. La respuesta es (aún) no puedes. Pero tienes dos caminos: utilizar una herramienta de compilación en la nube o instalar y configurar el entorno de <a href="http://developer.android.com/sdk/installing/index.html?pkg=adt">Android</a>. Vamos por la primera.</p>

<hr>

<h2>Herramientas</h2>

<p>Tal como comentaba unas líneas más arriba, Phonegap dispone de una serie de herramientas para facilitarnos el trabajo a los desarrolladores. He seleccionado tres de ellas, dos oficiales (Build &amp; Developer App) y otra de código abierto (Weinre).</p>

<h3>Build</h3>

<p><a href="https://build.phonegap.com/">Phonegap Build</a> es un servicio freemium que te permite <strong>compilar una APK/IPA directamente en la nube</strong>. La opción más básica te permite compilar un máximo de una app mobile, y por 10$ al mes podrás compilar hasta 25 aplicaciones.</p>

<p>En <a href="http://www.pounstudio.com">Poun Studio</a> tenemos una cuenta de pago y estamos bastante contentos con el servicio. Es verdad que aún le falta pulir algunos aspectos de la interfaz de usuario, pero hace lo que tiene que hacer eficiente y rápidamente. Por ejemplo compilar una app mobile Android e iOS tarda una media de 30 segundos. Y sobre todo te ahorras el problema de instalar y configurar cada SDK.</p>

<p>Puedes encontrar más información en <a href="http://blog.garciaechegaray.com/2014/07/07/compilando-una-app-en-la-nube-con-phonegap-build.html">Compilando una App en la nube con Phonegap Build</a>.</p>

<h3>Developer App</h3>

<p><a href="http://app.phonegap.com/">Phonegap Developer App</a> es otra herramienta oficial de Phonegap que te permite <strong>arrancar un servidor local con tu aplicación web</strong> y acceder a dicho servicio desde cualquier dispositivo móvil. </p>

<p>La opción más útil es que cualquier cambio en local se podrá visualizar <strong>instantáneamente</strong> en tu móvil. Esto mejora el flujo de trabajo ya que permite realizar pruebas sin la necesidad de compilar la aplicación.</p>

<p>Para arrancar el servidor local, es necesario lanzar este comando desde la ubicación actual de tu aplicación Phonegap:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ phonegap serve
</code></pre></div>
<p>Seguidamente deberás instalar la app mobile creada expresamente para conectarse a este servicio. En el caso de un dispositivo Android, sería <a href="https://play.google.com/store/apps/details?id=com.adobe.phonegap.app">Google Play - Phonegap Developer</a>. Ya solo queda escribir la IP de tu maquina, seguido del puerto asignado y darle al botón de conectar.</p>

<p>Uno de los defectos de esta herramienta es no poder acceder a la consola de desarrollo. Esto es un problema porque muchas veces no sabrás por donde vienen los tiros y el tiempo de debugear se alarga. Felizmente existe otra herramienta que soluciona este problema.</p>

<h3>Weinre</h3>

<p><a href="http://people.apache.org/%7Epmuellr/weinre-docs/latest/">Weinre</a> son la siglas de Web Inspector Remote. Básicamente es un <strong>debugger remoto</strong>, especialmente diseñado para trabajar con dispositivos móviles. 
Si aún no lo tenéis claro, aquí puedes ver un <a href="https://www.youtube.com/watch?v=4nL6xey13fE">video de 5 minutos</a> explicando el funcionamiento paso a paso.</p>

<p>Para instalar Weinre es necesario lanzar el siguiente comando:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ sudo npm -g install weinre
</code></pre></div>
<p>Para arrancar el servicio:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ weinre --boundHost your_IP --httpPort 8082
</code></pre></div>
<p>Dos cosas importantes: debemos usar nuestra IP para que el dispositivo móvil pueda acceder. Obviamente el dispositivo móvil no podrá acceder si lo configuras como <em>localhost</em>. Para evitar conflictos (con un servicio WAMP por ejemplo) utiliza un puerto alternativo, por ejemplo 8082.</p>

<p>El siguiente paso consiste en añadir un enlace del script de Weinre a tu aplicación web:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;script src=”http://your_IP:8082/target/target-script-min.js#anonymous”&gt;&lt;/script&gt;
</code></pre></div>
<p>Si todo ha salido bien, podrás acceder al servidor de Weinre. Desde aquí tendrás acceso a la consola de desarrollo para visualizar los posibles errores o incluso echarle un ojo al código fuente de tu aplicación web.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">http://your_IP:8082/
</code></pre></div>
<hr>

<h2>Instalar y compilar una app mobile con Android y Phonegap</h2>

<p>Si por alguna razón deseas compilar tu app en local, es necesario realizar algunos pasos previos.
Dichos pasos están muy bien explicados en este artículo de Stackoverflow: <a href="http://stackoverflow.com/a/21142421/2790889">Android with Linux development environment</a>.</p>

<h3>Paso a paso</h3>

<p><strong>1.- Instalar Android SDK</strong></p>

<p>Actualmente existen dos opciones, <a href="http://developer.android.com/sdk/index.html">ADT Bundle</a> basado en Eclipse o <a href="http://developer.android.com/sdk/installing/studio.html">Android Studio</a> basado en IntelliJ IDEA. </p>

<p><strong>Instalar Open JDK</strong></p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ sudo apt-get install openjdk-7-jre
</code></pre></div>
<p><strong>2.- Instalar Apache Ant</strong></p>

<p>Si seleccionas Android Studio, podrás saltarte este paso, ya viene configurado con <a href="http://www.gradle.org/">Gradle</a>.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ sudo apt-get install ant ant-contrib ant-optional ant-gcj
</code></pre></div>
<p><strong>3.- Editar PATH</strong></p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ cd ~/
gedit .bashrc
export HOME=&quot;/home/tu_nombre_de_usuario&quot;
export JAVA_HOME=&quot;/usr/lib/jvm/java-7-openjdk-i386&quot;
export ANDROID_HOME=&quot;$HOME/App/adt-bundle/sdk/tools&quot;
export ANDROID_PLATFORM_TOOLS=&quot;$HOME/App/adt-bundle/sdk/platform-tools&quot;
export PATH=&quot;$ANDROID_HOME:$ANDROID_PLATFORM_TOOLS:$PATH&quot;
export ANT_HOME=&quot;$HOME/App/ant&quot;
export PATH=&quot;$PATH:$ANT_HOME/bin&quot;
</code></pre></div>
<p><strong>4.- Actualizar Android SDK</strong></p>

<p>Antes de compilar tu app es necesario que actualizes el SDK. Esto puede tardar un buen rato, así que mucha paciencia.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ android sdk
</code></pre></div>
<p><strong>5.- Build &amp; Run</strong></p>

<p>Finalmente ya puedes compilar y lanzar un emulador de Android. Debes ir a tu proyecto y escribir estos comandos:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ phonegap install android
$ phonegap local build android
$ phonegap run android
</code></pre></div>
		</div>
	</div>
</div>

  </div>

  <!--Footer-->
  <div class="row">
    <hr>
    <footer>
      <div class="small-12 columns">
        <p>Blog desarrollado con <a href="http://jekyllrb.com">Jekyll</a> y <a href="http://foundation.zurb.com">Foundation</a>. Alojado en <a href="https://github.com/brunogarcia/brunogarcia.github.io">GitHub Pages</a>. Suscríbete al <a href="/feed.xml">RSS</a></p>
      </div>

    </footer>
  </div>

  <script src="/js/build/production.min.js"></script>
</body>
</html>
